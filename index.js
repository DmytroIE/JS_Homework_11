//*eslint-disable*/
/* eslint linebreak-style: ['error', 'windows'] */

const laptops = [
  {
    size: 13,
    color: 'white',
    price: 28000,
    release_date: 2015,
    name: 'Macbook Air White 13"',
    img: 'https://www.re-store.ru/upload/resize_cache/iblock/619/494_340_17f5c944b3b71591cc9304fac25365de2/619d9aedea6102641341df3d768d2ab4.jpg',
    descr:
      'Lorem ipsum dolor sit amet consectetur adipisicing elit. Quaerat, beatae.',
  },
  {
    size: 13,
    color: 'gray',
    price: 32000,
    release_date: 2016,
    name: 'Macbook Air Gray 13"',
    img: 'https://www.re-store.ru/upload/resize_cache/iblock/619/494_340_17f5c944b3b71591cc9304fac25365de2/619d9aedea6102641341df3d768d2ab4.jpg',
    descr:
      'Lorem ipsum dolor sit amet consectetur adipisicing elit. Quaerat, beatae.',
  },
  {
    size: 13,
    color: 'black',
    price: 35000,
    release_date: 2017,
    name: 'Macbook Air Black 13"',
    img: 'https://www.re-store.ru/upload/resize_cache/iblock/619/494_340_17f5c944b3b71591cc9304fac25365de2/619d9aedea6102641341df3d768d2ab4.jpg',
    descr:
      'Lorem ipsum dolor sit amet consectetur adipisicing elit. Quaerat, beatae.',
  },
  {
    size: 15,
    color: 'white',
    price: 45000,
    release_date: 2015,
    name: 'Macbook Air White 15"',
    img: 'https://www.re-store.ru/upload/resize_cache/iblock/619/494_340_17f5c944b3b71591cc9304fac25365de2/619d9aedea6102641341df3d768d2ab4.jpg',
    descr:
      'Lorem ipsum dolor sit amet consectetur adipisicing elit. Quaerat, beatae.',
  },
  {
    size: 15,
    color: 'gray',
    price: 55000,
    release_date: 2016,
    name: 'Macbook Pro Gray 15"',
    img: 'https://www.re-store.ru/upload/resize_cache/iblock/619/494_340_17f5c944b3b71591cc9304fac25365de2/619d9aedea6102641341df3d768d2ab4.jpg',
    descr:
      'Lorem ipsum dolor sit amet consectetur adipisicing elit. Quaerat, beatae.',
  },
  {
    size: 15,
    color: 'black',
    price: 45000,
    release_date: 2017,
    name: 'Macbook Pro Black 15"',
    img: 'https://www.re-store.ru/upload/resize_cache/iblock/619/494_340_17f5c944b3b71591cc9304fac25365de2/619d9aedea6102641341df3d768d2ab4.jpg',
    descr:
      'Lorem ipsum dolor sit amet consectetur adipisicing elit. Quaerat, beatae.',
  },
  {
    size: 17,
    color: 'white',
    price: 65000,
    release_date: 2015,
    name: 'Macbook Air White 17"',
    img: 'https://www.re-store.ru/upload/resize_cache/iblock/619/494_340_17f5c944b3b71591cc9304fac25365de2/619d9aedea6102641341df3d768d2ab4.jpg',
    descr:
      'Lorem ipsum dolor sit amet consectetur adipisicing elit. Quaerat, beatae.',
  },
  {
    size: 17,
    color: 'gray',
    price: 75000,
    release_date: 2016,
    name: 'Macbook Pro Gray 17"',
    img: 'https://www.re-store.ru/upload/resize_cache/iblock/619/494_340_17f5c944b3b71591cc9304fac25365de2/619d9aedea6102641341df3d768d2ab4.jpg',
    descr:
      'Lorem ipsum dolor sit amet consectetur adipisicing elit. Quaerat, beatae.',
  },
  {
    size: 17,
    color: 'black',
    price: 80000,
    release_date: 2017,
    name: 'Macbook Pro Black 17"',
    img: 'https://www.re-store.ru/upload/resize_cache/iblock/619/494_340_17f5c944b3b71591cc9304fac25365de2/619d9aedea6102641341df3d768d2ab4.jpg',
    descr:
      'Lorem ipsum dolor sit amet consectetur adipisicing elit. Quaerat, beatae.',
  },
  {
    size: 13,
    color: 'white',
    price: 28000,
    release_date: 2016,
    name: 'Macbook Air White 13"',
    img: 'https://www.re-store.ru/upload/resize_cache/iblock/619/494_340_17f5c944b3b71591cc9304fac25365de2/619d9aedea6102641341df3d768d2ab4.jpg',
    descr:
      'Lorem ipsum dolor sit amet consectetur adipisicing elit. Quaerat, beatae.',
  },
  {
    size: 13,
    color: 'gray',
    price: 32000,
    release_date: 2015,
    name: 'Macbook Air Gray 13"',
    img: 'https://www.re-store.ru/upload/resize_cache/iblock/619/494_340_17f5c944b3b71591cc9304fac25365de2/619d9aedea6102641341df3d768d2ab4.jpg',
    descr:
      'Lorem ipsum dolor sit amet consectetur adipisicing elit. Quaerat, beatae.',
  },
  {
    size: 13,
    color: 'gray',
    price: 35000,
    release_date: 2017,
    name: 'Macbook Air Gray 13"',
    img: 'https://www.re-store.ru/upload/resize_cache/iblock/619/494_340_17f5c944b3b71591cc9304fac25365de2/619d9aedea6102641341df3d768d2ab4.jpg',
    descr:
      'Lorem ipsum dolor sit amet consectetur adipisicing elit. Quaerat, beatae.',
  },
  {
    size: 13,
    color: 'black',
    price: 45000,
    release_date: 2015,
    name: 'Macbook Pro Black 13"',
    img: 'https://www.re-store.ru/upload/resize_cache/iblock/619/494_340_17f5c944b3b71591cc9304fac25365de2/619d9aedea6102641341df3d768d2ab4.jpg',
    descr:
      'Lorem ipsum dolor sit amet consectetur adipisicing elit. Quaerat, beatae.',
  },
  {
    size: 17,
    color: 'black',
    price: 45000,
    release_date: 2016,
    name: 'Macbook Pro Black 17"',
    img: 'https://www.re-store.ru/upload/resize_cache/iblock/619/494_340_17f5c944b3b71591cc9304fac25365de2/619d9aedea6102641341df3d768d2ab4.jpg',
    descr:
      'Lorem ipsum dolor sit amet consectetur adipisicing elit. Quaerat, beatae.',
  },
  {
    size: 17,
    color: 'white',
    price: 45000,
    release_date: 2016,
    name: 'Macbook Pro White 17"',
    img: 'https://www.re-store.ru/upload/resize_cache/iblock/619/494_340_17f5c944b3b71591cc9304fac25365de2/619d9aedea6102641341df3d768d2ab4.jpg',
    descr:
      'Lorem ipsum dolor sit amet consectetur adipisicing elit. Quaerat, beatae.',
  },
];


renderList(laptops);

// ***************************************************SUBMIT*********************************************************
const filterForm = document.querySelector('#filter-form');
filterForm.addEventListener('submit', handleSubmit);

function handleSubmit(e) {
  e.preventDefault();

  const filter = makeFilter();

  const filteredList = laptops.filter( (item) => {
    const filterKeys = Object.keys(filter);
    const isMatches = filterKeys.reduce( (acc, curr) => {
      // в filter все values - строки, а в объекте могут быть и числа, и пр. Для корректного сравнения нужно перевести все values объекта к строкам
      const isMatchesParticularProperty = acc 
                                          && ( !filter[curr].length 
                                               || (item[curr] 
                                                  && filter[curr].includes(String(item[curr]))) );
      // НИ один чекбокс в группе не выбран ИЛИ значение из объекта по ключу существует И есть в соотв. массиве фильтра
      return isMatchesParticularProperty;
    }, true);

    return isMatches;
  });

  renderList(filteredList);


}
// ************************************************RESET*****************************************************
const resetButton = document.querySelector('button[type="reset"]');
resetButton.addEventListener('click', handleReset);

function handleReset() {
  renderList(laptops);
}

// *******************************************AUX FUNCS*****************************************************
function renderList(list) {
  const container = document.querySelector('#card-container');
  if (!list.length) {
    container.innerHTML = '<p style="margin: 0 auto;">Sorry, nothing has been found!</p>';
    return;
  }
  const source = document.querySelector('#product-card').innerHTML.trim();
  const template = Handlebars.compile(source);
  const markup = list.reduce((acc, item) => acc + template(item), '');
  container.innerHTML = markup;
}


function makeFilter() {
  const filterObj = {};
  const listOfCheckboxes = filterForm.querySelectorAll('input[type=checkbox]');

  Array.prototype.forEach.call(listOfCheckboxes, (item) => {
    const name = item.getAttribute('name');
    if (!filterObj[name]) {
      filterObj[name] = [];
    }
    if (item.matches('input[type=checkbox]:checked')) {
      filterObj[name].push(item.getAttribute('value'));
    }
  });
  return filterObj;
}